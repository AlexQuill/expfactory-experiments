machine:
  services:
    - docker

general:
  artifacts:
    - .

test:
  override:
    - source $HOME/.bashrc    
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import validate_experiment_directories; validate_experiment_directories('.')"
    - sudo docker run -it -v $(pwd):/lint hyzual/jshint --config /lint/.jshint_config .
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','adaptive_n_back');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','angling_risk_task');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','antisaccade');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','ax_cpt');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','bickel_titrator');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','choice_reaction_time');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','cognitive_reflection');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','dietary_decision');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','digit_span');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','dimensional_set_shifting');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','directed_forgetting');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','discount_titrate');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','dospert_eb');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','dospert_rp');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','dospert_rt');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','flanker');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','go_nogo');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','hierarchical_rule');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','holt_laury');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','image_monitoring');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','keep_track');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','kirby');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','letter_memory');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','multiplication');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','multisource');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','n_back');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','number_letter');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','plus_minus');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','probabilistic_selection');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','psychological_refractory_period');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','random_number_generation');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','recent_probes');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','shift_task');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','simon');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','simple_reaction_time');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','test_task');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','threebytwo');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','tone_monitoring');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','tower_of_london');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','tower_of_london_imagine');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','two_stage_decision');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','volatile_bandit');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','willingness_to_wait');"
    - $HOME/miniconda2/bin/python -c "from expfactory.tests import circle_ci_test; circle_ci_test('web','writing_task');"
    - $HOME/miniconda2/bin/python -c "from expfactory.views import generate_experiment_web; generate_experiment_web('web')"

dependencies:
  pre:
    - echo "The Experiment Factory!"
    - wget http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh
    - chmod +x miniconda.sh
    - ./miniconda.sh -b
    - echo "export PATH=$HOME/miniconda2/bin:\\$PATH" >> $HOME/.bashrc
    - echo "export PATH=$HOME/miniconda2/bin:\\$PATH" >> $HOME/.env
    - source $HOME/.bashrc
    - conda update --yes conda
    - conda create --yes -n condaenv python=2.7
    - conda install --yes -n condaenv pip
    - source activate condaenv
    - $HOME/miniconda2/bin/pip install setuptools
    - $HOME/miniconda2/bin/conda install --yes pip numpy nose pandas cython numexpr scipy matplotlib scikit-learn scikit-image
    - $HOME/miniconda2/bin/pip install expfactory
    - $HOME/miniconda2/bin/pip install cognitiveatlas
    - docker pull hyzual/jshint
